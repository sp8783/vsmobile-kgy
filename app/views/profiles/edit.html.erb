<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900">設定</h1>
    <p class="mt-2 text-sm text-gray-600">アカウント設定を変更できます</p>
  </div>

  <div class="bg-white rounded-lg shadow">
    <div class="px-6 py-5 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900">プロフィール設定</h3>
    </div>

    <div class="p-6">
      <%= form_with(model: @user, url: profile_path, method: :patch, class: "space-y-6") do |form| %>
        <% if @user.errors.any? %>
          <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
            <h2 class="font-bold text-lg mb-2"><%= pluralize(@user.errors.count, "個のエラー") %>があります:</h2>
            <ul class="list-disc list-inside">
              <% @user.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <!-- ユーザー名（読み取り専用） -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ユーザー名</label>
          <div class="w-full px-3 py-2 border border-gray-200 rounded-md bg-gray-50 text-gray-500">
            <%= @user.username %>
          </div>
          <p class="mt-1 text-sm text-gray-500">ユーザー名は変更できません</p>
        </div>

        <!-- ニックネーム -->
        <div>
          <%= form.label :nickname, "ニックネーム", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :nickname, class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" %>
          <p class="mt-1 text-sm text-gray-500">画面上に表示される名前です</p>
        </div>

        <!-- 通知設定 -->
        <div class="border-t border-gray-200 pt-6" data-controller="push-subscription">
          <h4 class="text-sm font-medium text-gray-900 mb-4">通知設定</h4>
          <p class="text-sm text-gray-500 mb-4">ローテーションでの順番通知などをプッシュ通知で受け取れます。</p>

          <p data-push-subscription-target="status" class="text-sm text-gray-500 mb-3">
            確認中...
          </p>

          <p data-push-subscription-target="unsupportedMessage" class="hidden text-sm text-yellow-600 mb-3">
            このブラウザはプッシュ通知に対応していません。
            Chrome、Edge、Safari などの最新ブラウザをご利用ください。
          </p>

          <div class="flex gap-2">
            <button type="button"
                    data-push-subscription-target="subscribeButton"
                    data-action="click->push-subscription#subscribe"
                    class="hidden px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              プッシュ通知を有効にする
            </button>

            <button type="button"
                    data-push-subscription-target="unsubscribeButton"
                    data-action="click->push-subscription#unsubscribe"
                    class="hidden px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
              プッシュ通知を無効にする
            </button>
          </div>

          <p class="mt-3 text-xs text-gray-400">
            プッシュ通知はデバイスごとに設定が必要です。
            複数のデバイスで通知を受け取るには、それぞれで有効化してください。
          </p>
        </div>

        <!-- パスワード変更 -->
        <div class="border-t border-gray-200 pt-6">
          <h4 class="text-sm font-medium text-gray-900 mb-4">パスワード変更</h4>

          <div class="space-y-4">
            <div>
              <%= form.label :password, "新しいパスワード", class: "block text-sm font-medium text-gray-700 mb-1" %>
              <%= form.password_field :password, autocomplete: "new-password", class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" %>
              <p class="mt-1 text-sm text-gray-500">変更しない場合は空欄のままにしてください</p>
            </div>

            <div>
              <%= form.label :password_confirmation, "新しいパスワード（確認）", class: "block text-sm font-medium text-gray-700 mb-1" %>
              <%= form.password_field :password_confirmation, autocomplete: "new-password", class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" %>
            </div>
          </div>
        </div>

        <!-- 送信ボタン -->
        <div class="flex justify-end pt-4 border-t border-gray-200">
          <%= form.submit "保存", class: "px-6 py-2 bg-blue-600 text-white font-semibold rounded-md hover:bg-blue-700 cursor-pointer" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
