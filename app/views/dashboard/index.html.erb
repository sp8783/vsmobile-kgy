<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">ダッシュボード</h1>
    <p class="mt-2 text-sm text-gray-600">ようこそ、<%= current_user.nickname %>さん</p>
    <% if @user_total_matches == 0 %>
      <div class="mt-4 bg-blue-50 border-l-4 border-blue-400 p-4">
        <div class="flex">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
            </svg>
          </div>
          <div class="ml-3">
            <p class="text-sm text-blue-700">
              <span class="font-medium">初めての方へ：</span>
              対戦会でイベントが作成されたら、ローテーション表から試合に参加しましょう。試合結果を記録すると、ここに統計情報が表示されます。
            </p>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- 2カラムレイアウト -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- 左カラム（メインコンテンツ） -->
    <div class="lg:col-span-2 space-y-6">

      <!-- 1. リアルタイム待機状況カード（開催中のローテーション表がある場合のみ） -->
      <% if @active_rotation %>
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg rounded-lg p-6" data-controller="rotation-subscriber" data-rotation-subscriber-rotation-id-value="<%= @active_rotation.id %>">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h2 class="text-xl font-bold">🎮 <%= @today_event.name %> 開催中</h2>
              <p class="text-sm text-white text-opacity-90 mt-1"><%= @active_rotation.name %></p>
            </div>
            <span class="bg-white text-blue-600 px-3 py-1 rounded-full text-sm font-semibold">
              🔴 リアルタイム
            </span>
          </div>

          <!-- 現在の試合 -->
          <div class="bg-white rounded-lg p-4 mb-4 shadow-sm">
            <div class="text-sm font-semibold mb-2 text-blue-700">📍 現在の試合</div>
            <div class="text-3xl font-bold text-gray-900">第<%= @rotation_current_match_index + 1 %>試合</div>
            <div class="text-sm mt-1 text-gray-600">全<%= @rotation_total_matches %>試合中</div>
          </div>

          <% if @user_next_rotation_match %>
            <!-- あなたの次の出番 -->
            <div class="bg-gradient-to-r from-green-400 to-emerald-500 rounded-lg p-4 mb-4">
              <div class="text-sm font-semibold mb-2">⏰ あなたの次の出番</div>
              <div class="text-3xl font-bold mb-2">第<%= @user_next_rotation_match.match_index + 1 %>試合</div>

              <% if @matches_until_user_turn == 0 %>
                <div class="text-lg font-bold bg-red-500 text-white px-3 py-1 rounded inline-block animate-pulse mb-2">
                  🔔 今です！準備してください！
                </div>
              <% elsif @matches_until_user_turn == 1 %>
                <div class="text-base font-bold bg-orange-500 text-white px-3 py-1 rounded inline-block mb-2">
                  ⚠️ 次の試合です！
                </div>
              <% elsif @matches_until_user_turn <= 3 %>
                <div class="text-base font-semibold mb-2">
                  あと<%= @matches_until_user_turn %>試合後
                </div>
              <% else %>
                <div class="text-sm mb-2">
                  あと<%= @matches_until_user_turn %>試合後
                </div>
              <% end %>

              <% if @is_streaming %>
                <div class="bg-red-500 text-white px-3 py-1 rounded inline-block text-sm font-bold mb-2">
                  📹 配信担当
                </div>
              <% end %>

              <div class="border-t border-white border-opacity-30 mt-3 pt-3">
                <div class="text-sm mb-1">
                  <span class="font-semibold">パートナー:</span> <%= @user_partner.nickname %>
                </div>
                <div class="text-sm">
                  <span class="font-semibold">対戦相手:</span> <%= @opponent_players.map(&:nickname).join(' & ') %>
                </div>
              </div>
            </div>

            <%= link_to "📱 プレイヤー画面を開く", player_view_rotation_path(@active_rotation), class: "block w-full bg-indigo-600 text-white text-center font-semibold py-3 px-4 rounded hover:bg-indigo-700 transition mb-2", target: "_blank" %>
            <%= link_to "📊 ローテーション表全体を見る", rotation_path(@active_rotation), class: "block w-full bg-gray-600 text-white text-center font-semibold py-2 px-4 rounded hover:bg-gray-700 transition" %>
          <% else %>
            <div class="text-center py-4">
              <p class="text-white text-opacity-90">このローテーション表には参加していません</p>
              <%= link_to "ローテーション表を見る", rotation_path(@active_rotation), class: "mt-3 inline-block bg-gray-600 text-white font-semibold py-2 px-4 rounded hover:bg-gray-700 transition" %>
            </div>
          <% end %>
        </div>
      <% elsif @today_event %>
        <!-- ローテーション表がない場合の表示 -->
        <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-6">
          <h2 class="text-lg font-bold text-blue-900 mb-2">🎮 <%= @today_event.name %></h2>
          <p class="text-sm text-blue-700">アクティブなローテーション表がありません</p>
          <%= link_to "ローテーション表を作成", new_event_rotation_path(@today_event), class: "mt-3 inline-block bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded" %>
        </div>
      <% end %>

      <!-- 2. 調子メーター -->
      <div class="bg-white shadow rounded-lg p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-bold text-gray-900">📊 調子メーター</h2>
          <span class="text-xs text-gray-500" title="直近の試合結果から、現在の調子を確認できます">ℹ️ 最近の調子</span>
        </div>

        <div class="mb-4">
          <div class="text-sm text-gray-600 mb-2">直近5試合（左：最新 → 右：古い）</div>
          <div class="flex space-x-2">
            <% @recent_5_results.each do |result| %>
              <span class="text-2xl"><%= result ? '○' : '●' %></span>
            <% end %>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <div class="text-sm text-gray-600">直近10試合勝率</div>
            <div class="text-2xl font-bold text-blue-600"><%= @recent_10_win_rate %>%</div>
            <div class="text-xs <%= @recent_10_diff >= 0 ? 'text-blue-600' : 'text-red-600' %>">
              全体比 <%= @recent_10_diff >= 0 ? '+' : '' %><%= @recent_10_diff.round(1) %>%
            </div>
          </div>
          <div>
            <div class="text-sm text-gray-600">現在の連勝/連敗</div>
            <div class="text-2xl font-bold <%= @streak_type == 'win' ? 'text-blue-600' : 'text-red-600' %>">
              <%= @current_streak %><%= @streak_type == 'win' ? '連勝' : '連敗' %>
            </div>
          </div>
        </div>

        <% if @streak_type == 'win' && @current_streak >= 3 %>
          <div class="bg-blue-50 border border-blue-200 rounded p-3 text-sm text-blue-800">
            🔥 絶好調！この調子で勝ち続けましょう！
          </div>
        <% elsif @streak_type == 'lose' && @current_streak >= 3 %>
          <div class="bg-red-50 border border-red-200 rounded p-3 text-sm text-red-800">
            💪 落ち着いて！次は勝てます！
          </div>
        <% end %>
      </div>

      <!-- 3. 対戦会クイック比較 -->
      <div class="bg-white shadow rounded-lg p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-bold text-gray-900">📈 対戦会クイック比較</h2>
          <span class="text-xs text-gray-500" title="直近のイベントでの成績を比較できます">ℹ️ 最近3回</span>
        </div>
        <% events_with_matches = @event_comparison.select { |ec| ec[:total] > 0 } %>
        <% if events_with_matches.any? %>
          <div class="space-y-3">
            <% events_with_matches.each do |ec| %>
              <div class="border rounded p-3 <%= ec[:is_today] ? 'bg-blue-50 border-blue-300' : 'border-gray-200' %>">
                <div class="flex items-center justify-between mb-2">
                  <div>
                    <div class="font-semibold text-gray-900"><%= ec[:event].name %></div>
                    <div class="text-xs text-gray-500"><%= ec[:event].held_on.strftime('%Y年%m月%d日') %></div>
                  </div>
                  <% if ec[:is_today] %>
                    <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs font-semibold">開催中</span>
                  <% else %>
                    <span class="bg-gray-500 text-white px-2 py-1 rounded text-xs font-semibold">完了</span>
                  <% end %>
                </div>
                <div class="flex items-center space-x-4 text-sm">
                  <span class="text-gray-600">戦績: <%= ec[:wins] %>勝<%= ec[:losses] %>敗</span>
                  <span class="font-semibold text-blue-600">勝率: <%= ec[:win_rate] %>%</span>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="py-8 text-center">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            <p class="mt-2 text-sm text-gray-500">まだイベントの対戦記録がありません</p>
            <p class="mt-1 text-xs text-gray-400">イベントに参加して試合をすると、ここにイベントごとの成績が表示されます</p>
          </div>
        <% end %>
      </div>

      <!-- 4. 最近の対戦（5件） -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-5 border-b border-gray-200">
          <h2 class="text-lg font-bold text-gray-900">🕐 最近の対戦</h2>
        </div>
        <div class="divide-y divide-gray-200">
          <% if @recent_matches.any? %>
            <% @recent_matches.each do |match| %>
              <%
                # ログインユーザーのチームを特定
                my_player = match.match_players.find { |mp| mp.user_id == viewing_as_user.id }
              %>
              <%= link_to match_path(match), class: "block hover:bg-gray-50 px-6 py-4" do %>
                <div class="flex items-center justify-between mb-2">
                  <span class="text-xs text-gray-500"><%= match.played_at.strftime('%Y年%m月%d日') %></span>
                  <% if my_player %>
                    <% is_win = (match.winning_team == my_player.team_number) %>
                    <span class="text-xs font-bold px-2 py-0.5 rounded <%= is_win ? 'bg-blue-600 text-white' : 'bg-red-600 text-white' %>">
                      <%= is_win ? 'WIN' : 'LOSE' %>
                    </span>
                  <% end %>
                </div>
                <div class="text-xs text-gray-500 mb-2"><%= match.event.name %></div>

                <%
                  if my_player
                    my_team = my_player.team_number
                    opponent_team = my_team == 1 ? 2 : 1

                    my_team_players = match.match_players.select { |mp| mp.team_number == my_team }.sort_by(&:position)
                    opponent_players = match.match_players.select { |mp| mp.team_number == opponent_team }.sort_by(&:position)
                %>
                  <div class="grid grid-cols-2 gap-2 text-xs mt-2">
                    <div class="<%= match.winning_team == my_team ? 'bg-blue-50 border-2 border-blue-400' : 'bg-red-50 border-2 border-red-400' %> rounded p-2 relative">
                      <% if match.winning_team == my_team %>
                        <div class="absolute top-1 right-1">
                          <span class="text-xs font-bold px-2 py-0.5 rounded bg-blue-600 text-white">WIN</span>
                        </div>
                      <% else %>
                        <div class="absolute top-1 right-1">
                          <span class="text-xs font-bold px-2 py-0.5 rounded bg-red-600 text-white">LOSE</span>
                        </div>
                      <% end %>
                      <div class="font-semibold text-gray-700 mb-1">自チーム</div>
                      <% my_team_players.each_with_index do |player, index| %>
                        <div class="<%= (my_team == 1 && player.position == 1) ? 'text-red-600 font-bold' : 'text-gray-600' %>">
                          <%= player.user.nickname %> / <%= player.mobile_suit.name %>
                        </div>
                      <% end %>
                    </div>
                    <div class="<%= match.winning_team == opponent_team ? 'bg-blue-50 border-2 border-blue-400' : 'bg-red-50 border-2 border-red-400' %> rounded p-2 relative">
                      <% if match.winning_team == opponent_team %>
                        <div class="absolute top-1 right-1">
                          <span class="text-xs font-bold px-2 py-0.5 rounded bg-blue-600 text-white">WIN</span>
                        </div>
                      <% else %>
                        <div class="absolute top-1 right-1">
                          <span class="text-xs font-bold px-2 py-0.5 rounded bg-red-600 text-white">LOSE</span>
                        </div>
                      <% end %>
                      <div class="font-semibold text-gray-700 mb-1">相手チーム</div>
                      <% opponent_players.each_with_index do |player, index| %>
                        <div class="<%= (opponent_team == 1 && player.position == 1) ? 'text-red-600 font-bold' : 'text-gray-600' %>">
                          <%= player.user.nickname %> / <%= player.mobile_suit.name %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              <% end %>
            <% end %>
          <% else %>
            <div class="px-6 py-8 text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <p class="mt-2 text-sm text-gray-500">まだ試合記録がありません</p>
              <p class="mt-1 text-xs text-gray-400">イベントのローテーションから試合結果を記録すると、ここに表示されます</p>
            </div>
          <% end %>
        </div>
        <% if @recent_matches.any? %>
          <div class="px-6 py-4 bg-gray-50 text-center">
            <%= link_to "すべて見る →", matches_path, class: "text-sm text-blue-600 hover:text-blue-500" %>
          </div>
        <% end %>
      </div>

      <!-- 5. 対面相性マトリクス -->
      <div class="bg-white shadow rounded-lg p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-bold text-gray-900">⚔️ 対面相性マトリクス</h2>
          <span class="text-xs text-gray-500" title="よく使う機体での対戦相手との相性を確認できます">ℹ️ 機体相性</span>
        </div>
        <% if @matchup_matrix.any? %>
          <div class="space-y-4">
            <% @matchup_matrix.each do |matrix| %>
              <div class="border rounded p-4">
                <div class="font-semibold text-gray-900 mb-3">
                  <%= matrix[:my_suit].name %>
                  <span class="text-xs text-gray-500">（コスト<%= matrix[:my_suit].cost %>）</span>
                </div>
                <div class="space-y-2">
                  <% matrix[:matchups].each do |matchup| %>
                    <div class="flex items-center justify-between text-sm bg-gray-50 rounded p-2">
                      <div class="flex-1">
                        <span class="text-gray-700"><%= matchup[:opponent_suit].name %></span>
                        <span class="text-xs text-gray-500 ml-2"><%= matchup[:wins] %>勝<%= matchup[:losses] %>敗</span>
                      </div>
                      <div class="flex items-center space-x-2">
                        <span class="font-semibold <%= matchup[:win_rate] >= 60 ? 'text-blue-600' : (matchup[:win_rate] >= 40 ? 'text-gray-600' : 'text-red-600') %>">
                          <%= matchup[:win_rate] %>%
                        </span>
                        <span class="px-2 py-1 rounded text-xs font-semibold <%= matchup[:compatibility] == '得意' ? 'bg-blue-100 text-blue-800' : (matchup[:compatibility] == '普通' ? 'bg-gray-100 text-gray-800' : 'bg-red-100 text-red-800') %>">
                          <%= matchup[:compatibility] %>
                        </span>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-8">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
            <p class="mt-2 text-sm text-gray-500">データが不足しています</p>
            <p class="mt-1 text-xs text-gray-400">同じ機体で2試合以上対戦すると、相性データが表示されます</p>
          </div>
        <% end %>
      </div>

    </div>

    <!-- 右カラム（サブコンテンツ） -->
    <div class="lg:col-span-1 space-y-6">

      <!-- 1. 通知/アラート領域 -->
      <% if @notifications.any? %>
        <div class="space-y-3">
          <% @notifications.each do |notif| %>
            <div class="<%= notif[:type] == 'warning' ? 'bg-amber-50 border-amber-300' : 'bg-blue-50 border-blue-300' %> border rounded-lg p-4">
              <div class="flex items-start">
                <span class="text-2xl mr-3"><%= notif[:icon] %></span>
                <p class="text-sm <%= notif[:type] == 'warning' ? 'text-amber-800' : 'text-blue-800' %> font-medium">
                  <%= notif[:message] %>
                </p>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- 2. 個人戦績カード -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-5 border-b border-gray-200">
          <h2 class="text-lg font-bold text-gray-900">🏆 あなたの戦績</h2>
        </div>
        <div class="px-6 py-5">
          <div class="space-y-4">
            <div class="text-center">
              <div class="text-3xl font-bold text-blue-600"><%= @user_total_matches %></div>
              <div class="text-sm text-gray-500 mt-1">参加試合数</div>
            </div>
            <div class="text-center">
              <div class="text-3xl font-bold text-blue-600"><%= @user_wins %></div>
              <div class="text-sm text-gray-500 mt-1">勝利数</div>
            </div>
            <div class="text-center">
              <div class="text-3xl font-bold text-purple-600"><%= @user_win_rate %>%</div>
              <div class="text-sm text-gray-500 mt-1">勝率</div>
            </div>
          </div>
        </div>
      </div>

      <!-- 3. ベストパートナーTOP3 -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-5 border-b border-gray-200">
          <h2 class="text-lg font-bold text-gray-900">🤝 ベストパートナー</h2>
        </div>
        <div class="divide-y divide-gray-200">
          <% if @best_partners.any? %>
            <% @best_partners.each_with_index do |partner, index| %>
              <div class="px-6 py-4">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center">
                    <span class="text-lg font-bold text-gray-400 mr-2"><%= index + 1 %></span>
                    <div>
                      <div class="font-semibold text-gray-900"><%= partner[:user].nickname %></div>
                      <div class="text-xs text-gray-500"><%= partner[:wins] %>勝<%= partner[:total] - partner[:wins] %>敗</div>
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="text-lg font-bold text-blue-600"><%= partner[:win_rate] %>%</div>
                  </div>
                </div>
                <% if partner[:best_combo] %>
                  <div class="text-xs text-gray-600 bg-gray-50 rounded px-2 py-1 mt-2">
                    よく使う組み合わせ: <%= partner[:best_combo] %>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <div class="px-6 py-8 text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              <p class="mt-2 text-sm text-gray-500">まだデータがありません</p>
              <p class="mt-1 text-xs text-gray-400">同じパートナーと3試合以上プレイすると表示されます</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- 4. 機体使用トレンド（直近イベント） -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-5 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-bold text-gray-900">📱 機体トレンド</h2>
            <span class="text-xs text-gray-500" title="直近イベントでの使用機体と勝率">ℹ️ イベント別</span>
          </div>
          <% if @trend_event %>
            <p class="text-xs text-gray-500 mt-1">
              <%= @trend_event.name %>
              <% if @is_today_event %>
                <span class="ml-1 px-2 py-0.5 bg-blue-500 text-white rounded text-xs">開催中</span>
              <% end %>
            </p>
          <% end %>
        </div>
        <div class="divide-y divide-gray-200">
          <% if @event_suit_trend&.any? %>
            <% @event_suit_trend.each do |trend| %>
              <div class="px-6 py-4">
                <div class="flex items-center justify-between mb-1">
                  <div class="font-medium text-gray-900"><%= trend[:mobile_suit].name %></div>
                  <div class="text-sm font-semibold <%= trend[:win_rate] >= 60 ? 'text-blue-600' : 'text-gray-600' %>">
                    <%= trend[:win_rate] %>%
                  </div>
                </div>
                <div class="text-xs text-gray-500">使用回数: <%= trend[:usage] %>回</div>
                <% if trend[:recommended] %>
                  <div class="text-xs text-blue-600 mt-1">✨ 調子が良い機体です！</div>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <div class="px-6 py-8 text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
              </svg>
              <p class="mt-2 text-sm text-gray-500">まだ試合データがありません</p>
              <p class="mt-1 text-xs text-gray-400">イベントで試合をすると、機体の使用状況が表示されます</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- 5. コスト帯分析 -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-5 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-bold text-gray-900">💰 コスト帯分析</h2>
            <span class="text-xs text-gray-500" title="チームコストの組み合わせ別の勝率">ℹ️ コスト別</span>
          </div>
        </div>
        <div class="divide-y divide-gray-200">
          <% if @cost_analysis.any? %>
            <% @cost_analysis.each do |cost| %>
              <div class="px-6 py-4">
                <div class="flex items-center justify-between mb-2">
                  <div>
                    <div class="font-semibold text-gray-900"><%= cost[:cost_combo] %></div>
                    <div class="text-xs text-gray-500"><%= cost[:wins] %>勝<%= cost[:losses] %>敗</div>
                  </div>
                  <div class="text-right">
                    <div class="text-lg font-bold <%= cost[:win_rate] >= 60 ? 'text-blue-600' : (cost[:win_rate] >= 40 ? 'text-gray-600' : 'text-red-600') %>">
                      <%= cost[:win_rate] %>%
                    </div>
                    <span class="text-xs px-2 py-1 rounded <%= cost[:judgment] == '得意' ? 'bg-blue-100 text-blue-800' : (cost[:judgment] == '普通' ? 'bg-gray-100 text-gray-800' : 'bg-red-100 text-red-800') %>">
                      <%= cost[:judgment] %>
                    </span>
                  </div>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="px-6 py-8 text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <p class="mt-2 text-sm text-gray-500">まだデータがありません</p>
              <p class="mt-1 text-xs text-gray-400">同じコスト組み合わせで3試合以上プレイすると表示されます</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- 6. あなたのお気に入り機体（TOP3） -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-5 border-b border-gray-200">
          <h2 class="text-lg font-bold text-gray-900">⭐ お気に入り機体</h2>
        </div>
        <div class="divide-y divide-gray-200">
          <% if @user_favorite_suits.any? %>
            <% @user_favorite_suits.each_with_index do |suit, index| %>
              <div class="px-6 py-4 flex items-center justify-between">
                <div class="flex items-center">
                  <span class="text-lg font-bold text-gray-400 mr-3"><%= index + 1 %></span>
                  <div>
                    <div class="text-sm font-medium text-gray-900"><%= suit.name %></div>
                    <div class="text-xs text-gray-500"><%= suit.series %> / コスト<%= suit.cost %></div>
                  </div>
                </div>
                <span class="text-sm text-purple-600 font-semibold"><%= suit.usage_count %>回</span>
              </div>
            <% end %>
          <% else %>
            <div class="px-6 py-8 text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
              </svg>
              <p class="mt-2 text-sm text-gray-500">まだ試合がありません</p>
              <p class="mt-1 text-xs text-gray-400">試合に参加すると、よく使う機体が表示されます</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- 7. 今後のイベント -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-5 border-b border-gray-200">
          <h2 class="text-lg font-bold text-gray-900">📅 今後のイベント</h2>
        </div>
        <div class="divide-y divide-gray-200">
          <% if @upcoming_events.any? %>
            <% @upcoming_events.each do |event| %>
              <%= link_to event_path(event), class: "block hover:bg-gray-50 px-6 py-4" do %>
                <div class="text-sm font-medium text-gray-900"><%= event.name %></div>
                <div class="text-xs text-gray-500 mt-1"><%= event.held_on.strftime('%Y年%m月%d日') %></div>
              <% end %>
            <% end %>
          <% else %>
            <div class="px-6 py-4 text-center text-sm text-gray-500">
              予定されているイベントはありません
            </div>
          <% end %>
        </div>
        <div class="px-6 py-4 bg-gray-50 text-center">
          <%= link_to "すべて見る →", events_path, class: "text-sm text-blue-600 hover:text-blue-500" %>
        </div>
      </div>

      <!-- 8. クイックアクション -->
      <% if @latest_event %>
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 text-center">
          <h3 class="text-lg font-medium text-gray-900 mb-2">最新イベント</h3>
          <p class="text-sm font-semibold text-gray-700 mb-1"><%= @latest_event.name %></p>
          <p class="text-xs text-gray-600 mb-4"><%= @latest_event.held_on.strftime('%Y年%m月%d日') %></p>
          <%= link_to "対戦を記録する", new_event_match_path(@latest_event), class: "inline-block bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded" %>
        </div>
      <% end %>

    </div>
  </div>

  <!-- 下部全幅 - 人気の機体TOP5 -->
  <div class="mt-6">
    <div class="bg-white shadow rounded-lg">
      <div class="px-6 py-5 border-b border-gray-200">
        <h2 class="text-lg font-bold text-gray-900">🔥 人気の機体 TOP5</h2>
      </div>
      <div class="divide-y divide-gray-200">
        <% if @popular_mobile_suits.any? %>
          <div class="grid grid-cols-1 md:grid-cols-5 divide-y md:divide-y-0 md:divide-x divide-gray-200">
            <% @popular_mobile_suits.each_with_index do |suit, index| %>
              <div class="px-6 py-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-2xl font-bold text-gray-300"><%= index + 1 %></span>
                  <span class="text-sm text-blue-600 font-semibold"><%= suit.usage_count %>回</span>
                </div>
                <div class="text-sm font-medium text-gray-900"><%= suit.name %></div>
                <div class="text-xs text-gray-500 mt-1"><%= suit.series %></div>
                <div class="text-xs text-gray-500">コスト<%= suit.cost %></div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="px-6 py-8 text-center">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
            <p class="mt-2 text-sm text-gray-500">まだ試合データがありません</p>
            <p class="mt-1 text-xs text-gray-400">試合が記録されると、人気機体のランキングが表示されます</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>

</div>
